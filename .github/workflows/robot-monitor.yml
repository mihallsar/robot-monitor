name: Robot Catalog Monitor

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 UTC (13:00 –ú–°–ö)
    - cron: '0 9 * * *'
  workflow_dispatch: # –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  update-robots:
    runs-on: ubuntu-latest
    
    steps:
      - name: ü§ñ Run Robot Catalog Update
        run: |
          echo "üîç –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–∏—Å–∫ –Ω–æ–≤—ã—Ö —Ä–æ–±–æ—Ç–æ–≤..."
          
          response=$(curl -X POST \
            "https://backend.composio.dev/api/v1/rube/recipes/rcp_5ajueyVK76BF/execute" \
            -H "Content-Type: application/json" \
            -H "x-api-key: ${{ secrets.COMPOSIO_API_KEY }}" \
            -d '{
              "api_url": "https://robototehnika.vercel.app/api/robots",
              "api_key": "${{ secrets.ROBOT_API_KEY }}",
              "search_mode": "news",
              "max_robots_per_manufacturer": "10"
            }' \
            -w "\n%{http_code}" -s)
          
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | head -n-1)
          
          echo "üìä –°—Ç–∞—Ç—É—Å: $http_code"
          echo "üìÑ –û—Ç–≤–µ—Ç: $body"
          
          if [ "$http_code" -eq 200 ] || [ "$http_code" -eq 201 ]; then
            echo "‚úÖ –ö–∞—Ç–∞–ª–æ–≥ —Ä–æ–±–æ—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!"
          else
            echo "‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞"
            exit 1
          fi

      - name: üéâ Complete
        if: success()
        run: echo "‚ú® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!"
